 ### Возможности и описание работы etcd

#### Возможности etcd

С помощью etcd можно автоматически координировать большое количество идентичных машин, выбирать лидера и гарантировать идентичную историю данных в своем хранилище ключей-значений, так что:

1. Ни один узел etcd никогда не вернет данные, которые не согласованы с большинством узлов

2. Для размера кластера x любое количество машин > x/2 может продолжать работать и принимать записи, даже если другие умрут или потеряют связь

3. Для любых машин, теряющих связь (например, из-за сетевого разделения), они гарантированно будут продолжать возвращать правильные исторические данные, даже если они не смогут выполнить запись.

Хранилище «ключ-значение» само по себе довольно простое и ничего особенно интересного, но эти свойства позволяют создавать распределенные системы, которые устойчивы к сбоям отдельных компонентов и могут обеспечить разумные гарантии правильности.


RAFT дает etcd общий порядок событий в системе распределенных узлов etcd. Это имеет много преимуществ и недостатков:

***Преимущества включают в себя:***

1. Любой узел может рассматриваться как мастер

2. Минимальное время простоя (клиент может попробовать другой узел, если он не отвечает)

3. Избегает split-brane

4. Надежный способ создания распределенных блокировок для координации всего кластера

5. Пользователи etcd могут создавать распределенные системы без специальных, глючных, доморощенных решений

Например: вы можете использовать etcd для координирования автоматического выбора нового мастера Postgres, чтобы в кластере оставался только один мастер.

***Недостатки включают:***

1. Из соображений безопасности требуется, чтобы большая часть кластера выполняла запись — обычно на диск — перед ответом клиенту.

2. Требует больше сетевой болтовни, чем одна главная система

#### Хранилище etcd

Последним хранилищем для etcd является база данных bbolt, которая является хранилищем MVCC. Журнал RAFT — это журнал с упреждающей записью (также известный как WAL), который используется для достижения консенсуса между лидером и последователями и предотвращения потери информации, полученной от клиента.

Допустим, последователю приходит запрос на запись. Запрос перенаправляется к лидеру. Лидер записывает запрос в свой WAL и отправляет его всем последователям с помощью Raft. Как только кворум подтвердит, что запрос на запись был записан в соответствующий WAL, лидер фиксирует то же самое в базе данных bbolt и отправляет ответ клиенту.

Так что да, вы можете подумать, что существует «какая-то» косвенная связь между журналом Raft (WAL) и хранилищем данных etcd (база данных bbolt).
